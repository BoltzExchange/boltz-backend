---
description: >-
  This document gives an overview of how Boltz API clients should verify
  information generated by Boltz and other general measurements that should be
  undertaken to minimize trust.
---

# ðŸš« Don't trust. Verify!

## Basics

As a general concept, Boltz API clients should not trust any critical information obtained via the Boltz API. This applies _especially_ to chain addresses and lightning invoices where users will send bitcoin to.

## UTXO Chain Address Verification

Boltz currently supports two types of addresses:

* [P2SH nested P2WSH](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki#user-content-P2WSH\_nested\_in\_BIP16\_P2SH) for Normal Submarine Swaps
* [P2WSH](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki#user-content-P2WSH) for Reverse Submarine Swaps

Boltz API returns a redeem script and a derived chain address when creating swaps. After verifying that the redeem script is valid (checking preimage hash, public key, timeout block height of the HTLC and OP codes), Boltz API clients should verify the correctness of the address:

#### P2SH nested P2WSH

Although the output script of the P2SH nested P2WSH addresses is the same as the one of plain P2SH addresses, other data is hashed. Here, not the plain redeem script is hashed, but a P2WSH output script is constructed and hashed first with SHA256 and then with RIPEMD-160 as if it was the redeem script. The output script will look like this:

```
OP_EQUAL
OP_HASH160
<RIPEMD-160 hash of the SHA256 hash of the P2WSH output script>
```

#### P2WSH

In P2WSH addresses the reedem script is only hashed with SHA256. The output script is also a little simpler:

```
OP_0
<SHA256 hash of the redeem script>
```

#### Examples

Examples for generating all of these addresses with `Node.js` can be found in the [`boltz-core`](https://github.com/BoltzExchange/boltz-core/blob/master/lib/swap/Scripts.ts) reference library.

> Note: Address verification applies to all swap types involving a UTXO chain. A list of Bitcoin mainchain Opcodes with description can be found on the [Bitcoin Wiki](https://en.bitcoin.it/wiki/Script).

## Lightning Invoice Verification

Swap amounts should be calculated by the API client (taking into account network fee & Boltz fee from `/getpairs`). Boltz API Clients then should decode and verify that a Lightning invoice generated by Boltz

* Has the same SHA256 hash that the client previously generated and used to call `/createswap`.
* Has the same amount than the amount used to call `/createswap`.

Examples in JavaScript can be found [here](https://github.com/BoltzExchange/boltz-web-app/blob/main/src/utils/validation.js).

Boltz API clients should also verify that amounts in user-provided invoices match calculated swap amounts to prevent user error.

## EVM Chain Contract Verification

Boltz API Clients should verify that EVM swaps are carried out using the correct contract by comparing the bytecode of the contract.

## General Measurements

Boltz API Client should verify that `expectedAmount` in Boltz API responses matches locally calculated amount.
